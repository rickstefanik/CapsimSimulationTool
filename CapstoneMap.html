<!DOCTYPE html>
<html>
    <head>
        <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
            integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
            crossorigin="anonymous"
        />
        <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->

        <script
            src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"
        ></script>
    </head>

    <style>
        .equal {
            display: flex;
            display: -webkit-flex;
            flex-wrap: wrap;
        }
    </style>

    <body style="background-color:#DDDDDD">
        <div class="row my-2 mx-1">
            <div class="col-lg-6 text-center">
                <canvas
                    id="myCanvas"
                    width="600"
                    height="600"
                    style="border:1px solid #d3d3d3;"
                >
                    Your browser does not support the HTML5 canvas tag.
                </canvas>
                <div class="row">
                    <div class="col-lg-12 text-center">
                        <div class="row">
                            <div class="col-lg-12 text-center">
                                <div class="btn-group text-center" role="group">
                                    <button
                                        type="button"
                                        class="btn btn-danger"
                                        id="driftBackButton"
                                    >
                                        Back One Month
                                    </button>
                                    <button
                                        type="button"
                                        class="btn btn-primary"
                                        id="driftButton"
                                    >
                                        Forward One Month
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="row my-2">
                            <div class="col-lg-12 text-center">
                                <div class="btn-group text-center" role="group">
                                    <button
                                        type="button"
                                        class="btn btn-danger"
                                        id="driftBackYearButton"
                                    >
                                        Back One Year
                                    </button>
                                    <button
                                        type="button"
                                        class="btn btn-primary"
                                        id="driftYearButton"
                                    >
                                        Forward One Year
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="row my-2">
                            <div class="col-lg-4"></div>
                            <div class="col-lg-4">
                                <div class="alert alert-primary">
                                    <b>
                                        <span id="xClickSpan"> X: </span>
                                        <span id="yClickSpan"> Y: </span>
                                    </b>
                                </div>
                            </div>
                            <div class="col-lg-4"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 text-center">
                <div class="row">
                    <div class="col-lg-6 text-center equal">
                        <div class="alert alert-primary" role="alert">
                            <h1>Add a Product</h1>
                            <form>
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text"
                                            >Name</label
                                        >
                                    </div>
                                    <input
                                        class="form-control"
                                        id="nameInput"
                                    />
                                </div>

                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text"
                                            >Performance</label
                                        >
                                    </div>
                                    <input
                                        class="form-control"
                                        id="performanceInput"
                                    />
                                </div>

                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text"
                                            >Size</label
                                        >
                                    </div>
                                    <input
                                        class="form-control"
                                        id="sizeInput"
                                    />
                                </div>

                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text"
                                            >Color</label
                                        >
                                    </div>
                                    <select
                                        class="form-control"
                                        id="colorInput"
                                    >
                                        <option>red</option>
                                        <option>green</option>
                                        <option>blue</option>
                                        <option>purple</option>
                                        <option>orange</option>
                                        <option>pink</option>
                                        <option>tan</option>
                                    </select>
                                </div>
                            </form>
                            <button
                                id="newProductButton"
                                class="btn btn-success text-center"
                            >
                                Submit
                            </button>
                        </div>
                    </div>
                    <div class="col-lg-6 text-center equal">
                        <div class="alert alert-primary" role="alert">
                            <h1>Import Products</h1>
                            <form>
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text"
                                            >Import Type</label
                                        >
                                    </div>
                                    <select
                                        class="form-control"
                                        id="importTypeInput"
                                    >
                                        <option>From Capstone</option>
                                        <option>From Courier</option>
                                    </select>
                                </div>

                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text"
                                            >Data</label
                                        >
                                    </div>
                                    <input
                                        class="form-control"
                                        id="capstoneInput"
                                    />
                                </div>

                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text"
                                            >Color</label
                                        >
                                    </div>
                                    <select
                                        class="form-control"
                                        id="colorInput2"
                                    >
                                        <option>red</option>
                                        <option>green</option>
                                        <option>blue</option>
                                        <option>purple</option>
                                        <option>orange</option>
                                        <option>pink</option>
                                        <option>tan</option>
                                    </select>
                                </div>
                            </form>
                            <button
                                id="importProductsButton"
                                class="btn btn-success text-center"
                            >
                                Submit
                            </button>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12 text-center">
                        <div class="alert alert-primary" role="alert">
                            <h1>Current Products</h1>
                            <div id="productDiv"></div>
                            <button
                                style="visibility: hidden"
                                id="deleteAllButton"
                                class="btn btn-danger text-center"
                            >
                                Delete All
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            let curYear = 2020;
            let MONTHS = [
                "January",
                "February",
                "March",
                "April",
                "May",
                "June",
                "July",
                "August",
                "September",
                "October",
                "November",
                "December"
            ];
            let circles = [
                {
                    name: "traditional",
                    x: 5,
                    y: 15,
                    r1: 2.5,
                    r2: 4,
                    driftX: 0.7 / 12,
                    driftY: -1 * (0.7 / 12),
                    offsetX: 0,
                    offsetY: 0
                },
                {
                    name: "low-end",
                    x: 2.5,
                    y: 17.5,
                    r1: 2.5,
                    r2: 4,
                    driftX: 0.5 / 12,
                    driftY: -1 * (0.5 / 12),
                    offsetX: -0.8,
                    offsetY: 0.8
                },
                {
                    name: "high-end",
                    x: 7.5,
                    y: 12.5,
                    r1: 2.5,
                    r2: 4,
                    driftX: 0.9 / 12,
                    driftY: -1 * (0.9 / 12),
                    offsetX: 1.4,
                    offsetY: -1.4
                },
                {
                    name: "size",
                    x: 3,
                    y: 12,
                    r1: 2.5,
                    r2: 4,
                    driftX: 0.7 / 12,
                    driftY: -1 * (1 / 12),
                    offsetX: 1,
                    offsetY: -1.4
                },
                {
                    name: "performance",
                    x: 8,
                    y: 17,
                    r1: 2.5,
                    r2: 4,
                    driftX: 1 / 12,
                    driftY: -1 * (0.7 / 12),
                    offsetX: 1.4,
                    offsetY: -1
                }
            ];
            // let products = [{x: 5, y:4, name: "Dixie", color: "green"}];
            let products = [];
            let curMonth = 0;

            let redraw = function() {
                var c = document.getElementById("myCanvas");
                var ctx = c.getContext("2d");

                ctx.clearRect(0, 0, c.width, c.height);
                ctx.fillStyle = "white";
                ctx.fillRect(0, 0, c.width, c.height);

                ctx.fillStyle = "black";
                let drawLine = function(x, y, x1, y1) {
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(x1, y1);
                    ctx.stroke();
                };

                function getMousePos(canvas, evt) {
                    var rect = canvas.getBoundingClientRect();
                    // return {
                    //     x: evt.clientX - rect.left,
                    //     y: evt.clientY - rect.top
                    // };
                    console.log(evt.clientX - rect.left);
                    console.log(evt.clientY - rect.top);
                }

                let map = function(xVal, yVal) {
                    return {
                        x: xVal * 25 + 50,
                        y: 552 - yVal * 25
                    };
                };

                let getRad = function(r) {
                    return r * 25;
                };

                ctx.font = "20px Arial";
                for (let i = 0; i <= 10; i++) {
                    let xGrid = 40 + 50 * i;
                    ctx.fillText((i * 2).toString(), xGrid, 575);
                    drawLine(xGrid + 10, 552, xGrid + 10, 50);
                }

                for (let i = 11; i >= 1; i--) {
                    let yGrid = 10 + 50 * i;
                    ctx.fillText(((10 - i + 1) * 2).toString(), 20, yGrid);
                    drawLine(50, yGrid - 8, 550, yGrid - 8);
                }
                ctx.fillText(MONTHS[curMonth] + " " + curYear, 250, 25);

                let drawCircle = function(x, y, r) {
                    ctx.fillStyle = "black";
                    let radius = getRad(r);
                    let q = map(x, y);
                    let centerX = q.x;
                    let centerY = q.y;

                    ctx.fillStyle = "black";
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                    ctx.stroke();
                };

                let drawDottedCircle = function(cX, cY, r) {
                    ctx.fillStyle = "black";
                    let radius = getRad(r);
                    let q = map(cX, cY);
                    let centerX = q.x;
                    let centerY = q.y;

                    var canvas = document.getElementById("myCanvas");
                    var context = canvas.getContext("2d");

                    var dotsPerCircle = 75;

                    var interval = (Math.PI * 2) / dotsPerCircle;
                    for (var i = 0; i < dotsPerCircle; i++) {
                        desiredRadianAngleOnCircle = interval * i;

                        var x =
                            centerX +
                            radius * Math.cos(desiredRadianAngleOnCircle);
                        var y =
                            centerY +
                            radius * Math.sin(desiredRadianAngleOnCircle);

                        context.beginPath();
                        context.arc(x, y, 1, 0, Math.PI * 2);
                        context.closePath();
                        context.fill();
                    }
                };

                let drawPoint = function(cX, cY, color, text) {
                    ctx.fillStyle = "black";
                    let q = map(cX, cY);
                    let x = q.x;
                    let y = q.y;

                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, 2 * Math.PI);
                    ctx.stroke();
                    ctx.fillStyle = color;
                    ctx.fill();
                    ctx.font = "15px Arial";
                    ctx.fillText(text, x - 15, y - 10);
                };

                for (let i = 0; i < circles.length; i++) {
                    let cur = circles[i];
                    drawCircle(cur.x, cur.y, cur.r1);
                    drawPoint(
                        cur.x + cur.offsetX,
                        cur.y + cur.offsetY,
                        cur.color,
                        cur.name
                    );
                    drawDottedCircle(cur.x, cur.y, cur.r2);
                }

                for (let i = 0; i < products.length; i++) {
                    let cur = products[i];
                    drawPoint(cur.x, cur.y, cur.color, cur.name);
                }

                //    let productList = document.getElementById("productDiv");
                let pListString = "";
                for (let i = 0; i < products.length; i++) {
                    pListString +=
                        '<div class="card text-white bg-secondary my-1">  <div style="padding: .25rem;"class="card-body">';
                    pListString +=
                        '<h4 style="display: inline"><span class="badge badge-pill badge-dark badge-large">' +
                        products[i].name +
                        "</span></h4>";
                    pListString += " - Performance: ";
                    pListString += products[i].x;
                    pListString += `<div class="btn-group mx-2" role="group" aria-label="Basic example">
                            <button type="button" class="btn btn-sm btn-primary pfmnDecButton" id="pfmnDec`;
                    pListString += products[i].name + '"';
                    pListString += `>-</button> <button type="button" class="btn btn-sm btn-primary pfmnIncButton" id="pfmnInc`;
                    pListString += products[i].name + '"';
                    pListString += `>+</button> </div>`;
                    pListString += " Size: ";
                    pListString += products[i].y;
                    pListString += `<div class="btn-group mx-2" role="group" aria-label="Basic example">
                            <button type="button" class="btn btn-sm btn-primary sizeDecButton" id="sizeDec`;
                    pListString += products[i].name + '"';
                    pListString += `>-</button> <button type="button" class="btn btn-sm btn-primary sizeIncButton" id="sizeInc`;
                    pListString += products[i].name + '"';
                    pListString += `>+</button> </div>`;
                    pListString +=
                        '<button class="deleteProductButton btn btn-danger mx-2" id="';
                    pListString += products[i].name;
                    pListString += '"> Delete </button>';
                    pListString += "</div></div>";
                }

                // $(".deleteProductButton").click(function() {
                //     console.log("HI");
                // });
                document.getElementById("productDiv").innerHTML = pListString;
            };
            redraw();

            let drift = function() {
                for (let i = 0; i < circles.length; i++) {
                    circles[i].x += circles[i].driftX;
                    circles[i].y += circles[i].driftY;
                }
                curMonth += 1;
                if (curMonth == 12) {
                    curMonth = 0;
                    curYear++;
                }
                redraw();
            };

            let backDrift = function() {
                for (let i = 0; i < circles.length; i++) {
                    circles[i].x -= circles[i].driftX;
                    circles[i].y -= circles[i].driftY;
                }
                curMonth -= 1;
                if (curMonth == -1) {
                    curMonth = 11;
                    curYear--;
                }
                redraw();
            };

            $("body").on("click", ".deleteProductButton", function() {
                for (let i = products.length - 1; i >= 0; i--) {
                    if (products[i].name == $(this)[0]["id"]) {
                        products.splice(i, 1);
                    }
                }
                if (products.length == 0) {
                    document.getElementById(
                        "deleteAllButton"
                    ).style.visibility = "hidden";
                }
                redraw();
            });

            $("body").on("click", ".pfmnDecButton", function() {
                for (let i = products.length - 1; i >= 0; i--) {
                    if (products[i].name == $(this)[0]["id"].substring(7)) {
                        products[i].x = (
                            Math.round((parseFloat(products[i].x) - 0.1) * 10) /
                            10
                        ).toString();
                    }
                }
                redraw();
            });

            $("body").on("click", ".pfmnIncButton", function() {
                for (let i = products.length - 1; i >= 0; i--) {
                    if (products[i].name == $(this)[0]["id"].substring(7)) {
                        products[i].x = (
                            Math.round((parseFloat(products[i].x) + 0.1) * 10) /
                            10
                        ).toString();
                    }
                }
                redraw();
            });

            $("body").on("click", ".sizeDecButton", function() {
                for (let i = products.length - 1; i >= 0; i--) {
                    if (products[i].name == $(this)[0]["id"].substring(7)) {
                        products[i].y = (
                            Math.round((parseFloat(products[i].y) - 0.1) * 10) /
                            10
                        ).toString();
                    }
                }
                redraw();
            });

            $("body").on("click", ".sizeIncButton", function() {
                for (let i = products.length - 1; i >= 0; i--) {
                    if (products[i].name == $(this)[0]["id"].substring(7)) {
                        products[i].y = (
                            Math.round((parseFloat(products[i].y) + 0.1) * 10) /
                            10
                        ).toString();
                    }
                }
                redraw();
            });

            let makeNewProduct = function(
                performanceInput,
                sizeInput,
                nameInput,
                colorInput
            ) {
                products.push({
                    x: performanceInput,
                    y: sizeInput,
                    name: nameInput,
                    color: colorInput
                });
                document.getElementById("deleteAllButton").style.visibility =
                    "visible";

                redraw();
            };

            let dButton = document.getElementById("driftButton");
            dButton.onclick = function() {
                drift();
            };

            let dyButton = document.getElementById("driftYearButton");
            dyButton.onclick = function() {
                for (let i = 0; i < 12; i++) {
                    drift();
                }
            };

            let dbButton = document.getElementById("driftBackButton");
            dbButton.onclick = function() {
                backDrift();
            };

            let dbyButton = document.getElementById("driftBackYearButton");
            dbyButton.onclick = function() {
                for (let i = 0; i < 12; i++) {
                    backDrift();
                }
            };

            let pButton = document.getElementById("newProductButton");
            pButton.onclick = function() {
                let nameInput = document.getElementById("nameInput").value;
                let performanceInput = document.getElementById(
                    "performanceInput"
                ).value;
                let sizeInput = document.getElementById("sizeInput").value;
                let colorInput = document.getElementById("colorInput").value;

                makeNewProduct(
                    performanceInput,
                    sizeInput,
                    nameInput,
                    colorInput
                );
            };

            let importButton = document.getElementById("importProductsButton");
            importButton.onclick = function() {
                let typeImport = document.getElementById("importTypeInput")
                    .value;
                let cString = document.getElementById("capstoneInput").value;
                let colorInput = document.getElementById("colorInput2").value;

                let flaggedWords = [
                    "Andrews",
                    "Baldwin",
                    "Chester",
                    "Digby",
                    "Erie",
                    "Ferris",
                    "Name",
                    "Pfmn",
                    "Size",
                    "Revised"
                ];

                let d = cString
                    .split(/(\s+)/)
                    .filter(a => /\S/.test(a))
                    .filter(a => {
                        for (let j = 0; j < flaggedWords.length; j++) {
                            if (a === flaggedWords[j]) {
                                return false;
                            }
                        }
                        return a.indexOf("/") === -1;
                    });

                if (typeImport === "From Capstone") {
                    let i = 0;
                    while (i < d.length) {
                        if (d[i].length > 0 && d[i][0] == "D") {
                            makeNewProduct(
                                d[i + 1],
                                d[i + 2],
                                d[i],
                                colorInput
                            );
                        }
                        i++;
                    }
                } else if (typeImport === "From Courier") {
                    console.log(d);
                    for (let i = 0; i < d.length; i += 3) {
                        //console.log(d[i]);
                        makeNewProduct(d[i + 1], d[i + 2], d[i], colorInput);
                    }
                }
            };

            let getCursorPosition = function(c, event) {
                var rect = c.getBoundingClientRect();
                var x = event.clientX - rect.left;
                var y = event.clientY - rect.top;

                let xClickPos = (x - 50) / 25;
                let yClickPos = (-1 * (y - 552)) / 25;

                document.getElementById("xClickSpan").innerHTML =
                    "X: " + xClickPos.toString();
                document.getElementById("yClickSpan").innerHTML =
                    "Y: " + yClickPos.toString();
            };

            $("#myCanvas").click(function(e) {
                let canv = document.getElementById("myCanvas");
                getCursorPosition(canv, e);
            });

            let clearNewFields = function() {
                document.getElementById("nameInput").value = "";
                document.getElementById("sizeInput").value = "";
                document.getElementById("performanceInput").value = "";
            };

            $("#nameInput, #sizeInput, #performanceInput").on("keyup", function(
                e
            ) {
                if (e.keyCode == 13) {
                    $("#newProductButton").click();
                    clearNewFields();
                }
            });

            $("#deleteAllButton").click(function() {
                products = [];
                document.getElementById("deleteAllButton").style.visibility =
                    "hidden";
                redraw();
            });
        </script>
    </body>
</html>
